<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Selector</title>
    <style>
        .tag {
            display: inline-block;
            background-color: #e0e0e0;
            padding: 5px;
            margin: 5px;
            border-radius: 5px;
        }

        .st_22_search_cities_items {
            /* Add your styles for the city items here */
        }

        .selected {
            background-color: #c0c0c0; /* Change this to your desired selected color */
        }

        .popular-icon {
            color: gold; /* Change this to your desired popular icon color */
            margin-left: 5px;
        }
        span.city-thumb img {
    width: 20px;
}
    </style>
</head>
<body>

<div class="dropdown mx-2">
    <button class="btn btn-light dropdown-toggle dynamic-dropdown searchBy-buttons  h-100" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
        <img src="images/airline/package-page/icon-country.svg" alt="" class="me-2">
        Countries
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
        <li><a class="dropdown-item" href="javascript:void(0)" data-id="allCountries">All Countries</a></li>
        <li><a class="dropdown-item" href="javascript:void(0)" data-id="Switzerland">Switzerland</a></li>
        <li><a class="dropdown-item" href="javascript:void(0)" data-id="France">France</a></li>
    </ul>
</div>

<div>
    <button class="btn btn-light searchBy-buttons h-100 text-start lh-sm" id="showPopularCities">Popular Cities</button>
</div>

<div class="searchCity-input">
    <input type="search" class="citySearch-inputBox" placeholder="City" id="cityInput">
    <ul class="suggestedCities">
        <!-- Suggestions will be dynamically generated using JavaScript -->
    </ul>
</div>
<div class="searchCity-info">
  <div class="searchCity-thumb"></div>
  <span class="searchCity-info-tag"></span>
</div>

<div id="selectedCities"></div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        // Array to store selected cities
        var selectedCities = [];
        var selectedCitiesArray = [];

        // JSON data
        var jsonData = [
              {
                text: "Switzerland",
                html: "Switzerland",
                title: "All,Popular,Switzerland",
                children: [
                  {
                    id: 1,
                    text: "Interlaken, Switzerland",
                    html: "Interlaken, Switzerland",
                    title: "All,Interlaken,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 2,
                    text: "Lucerne, Switzerland",
                    html: "Lucerne, Switzerland",
                    title: "All,Lucerne,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 3,
                    text: "Zurich, Switzerland",
                    html: "Zurich, Switzerland",
                    title: "All,Zurich,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 4,
                    text: "St Moritz, Switzerland",
                    html: "St Moritz, Switzerland",
                    title: "All,St Moritz,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 5,
                    text: "Lugano, Switzerland",
                    html: "Lugano, Switzerland",
                    title: "All,Lugano,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 6,
                    text: "Grindelwald, Switzerland",
                    html: "Grindelwald, Switzerland",
                    title: "All,Grindelwald,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 7,
                    text: "Zermatt,Switzerland",
                    html: "Zermatt, Switzerland",
                    title: "All,Zermatt,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 8,
                    text: "Gstaad, Switzerland",
                    html: "Gstaad, Switzerland",
                    title: "All,Gstaad,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 9,
                    text: "Geneva, Switzerland",
                    html: "Geneva, Switzerland",
                    title: "All,Geneva,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 10,
                    text: "Chur, Switzerland",
                    html: "Chur, Switzerland",
                    title: "All,Chur,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 11,
                    text: "Bern, Switzerland",
                    html: "Bern, Switzerland",
                    title: "All,Bern,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 12,
                    text: "Davos, Switzerland",
                    html: "Davos, Switzerland",
                    title: "All,Davos,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 13,
                    text: "Lausanne, Switzerland",
                    html: "Lausanne, Switzerland",
                    title: "All,Lausanne,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 14,
                    text: "Ascona, Switzerland",
                    html: "Ascona, Switzerland",
                    title: "All,Ascona,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 15,
                    text: "Basel, Switzerland",
                    html: "Basel, Switzerland",
                    title: "All,Basel,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 16,
                    text: "Vevey, Switzerland",
                    html: "Vevey, Switzerland",
                    title: "All,Vevey,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 17,
                    text: "Locarno, Switzerland",
                    html: "Locarno, Switzerland",
                    title: "All,Locarno,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 18,
                    text: "Crans-Montana, Switzerland",
                    html: "Crans-Montana, Switzerland",
                    title: "All,Crans-Montana,Switzerland",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 19,
                    text: "Montreux, Switzerland",
                    html: "Montreux, Switzerland",
                    title: "All,Montreux,Switzerland,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                ],
              },
              {
                text: "France",
                html: "France",
                title: "All,Popular,France",
                children: [
                  {
                    id: 20,
                    text: "Paris, France",
                    html: "Paris, France",
                    title: "All,Paris,France,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                  {
                    id: 21,
                    text: "Nice, France",
                    html: "Nice, France",
                    title: "All,Nice,France,Popular",
                    image: "https://images.pexels.com/photos/290275/pexels-photo-290275.jpeg",
                  },
                ],
              },
            ];

        // Function to update searchCity-info and searchCity-thumb elements
function updateSearchCityInfo() {
    var searchCityThumb = $('.searchCity-thumb');
    var searchCityInfoTag = $('.searchCity-info-tag');

    // Clear existing content
    searchCityThumb.empty();
    searchCityInfoTag.empty();

    // Display the first object in the array
    if (selectedCitiesArray.length > 0) {
        var firstCity = selectedCitiesArray[0];
        searchCityInfoTag.text(firstCity.text);

        // Display additional count if there are more than one city in the array
        if (selectedCitiesArray.length > 1) {
            var count = selectedCitiesArray.length - 1;
            searchCityInfoTag.append(' +' + count);
        }

        // Display each city in searchCity-thumb with image
        selectedCitiesArray.forEach(function (city) {
          console.log(selectedCitiesArray)
            searchCityThumb.append('<span class="city-thumb"><img src="' + city.image + '" alt="' + city.text + '">' + city.text + '</span>');
        });
    }
}


      function updateSelectedCities() {
    $('#selectedCities').empty();
    selectedCitiesArray.forEach(function (city) {
        $('#selectedCities').append('<div class="tag">' + city.text + ' <span class="remove" data-html="' + city.html + '">X</span></div>');
    });
}

        // Function to generate suggested cities based on the provided JSON
        function generateSuggestions(cities) {
            var suggestions = '';
            cities.forEach(function (city) {
                // Add an <i> tag with a popular icon if the city is popular
                var popularIcon = city.title.includes('Popular') ? '<i class="popular-icon">★</i>' : '';
                suggestions += '<li class="city-item" data-html="' + city.html + '">' + city.text + popularIcon + '</li>';
            });
            $('.suggestedCities').html(suggestions);
        }

        // Event handler for input change
        $('.citySearch-inputBox').on('input', function () {
            var searchValue = $(this).val().toLowerCase();
            $('.city-item').each(function () {
                var cityText = $(this).text().toLowerCase();
                if (cityText.includes(searchValue)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });

        // Event handler for clicking on suggested cities
// Event handler for clicking on suggested cities
$('.suggestedCities').on('click', '.city-item', function () {
    var cityHtml = $(this).data('html');
    var cityName = $(this).text();
    var selectedCity = jsonData.flatMap(country => country.children).find(city => city.html === cityHtml);
    var cityImage = selectedCity ? selectedCity.image : null;

    if (!selectedCitiesArray.some(city => city.text === cityName)) {
        selectedCitiesArray.push({ text: cityName, html: cityHtml, image: cityImage });
        updateSelectedCities();
        updateSearchCityInfo(); // Update searchCity-info and searchCity-thumb
        $(this).addClass('selected');
    }
});



        $('#selectedCities').on('click', '.remove', function (event) {
    var cityToRemove = $(this).data('html');

    // Remove the 'selected' class from the corresponding city-item
    $('.suggestedCities .city-item[data-html="' + cityToRemove + '"]').removeClass('selected');

    // Remove the city from the new array
    selectedCitiesArray = selectedCitiesArray.filter(city => city.html !== cityToRemove);

    // Update the display
    updateSelectedCities();

    // Update the searchCity-info and searchCity-thumb
    updateSearchCityInfo();

    event.stopPropagation(); // Prevents the event from propagating to parent elements
});



        // Event handler for clicking on "Popular Cities" button
        $('#showPopularCities').on('click', function () {
            var popularCities = jsonData.flatMap(country => country.children.filter(city => city.title.includes('Popular')));
            generateSuggestions(popularCities);
        });

        // Event handler for clicking on country dropdown items
        $('.dropdown-menu').on('click', '.dropdown-item', function () {
            var selectedCountry = $(this).data('id');
            if (selectedCountry === 'allCountries') {
                generateSuggestions(jsonData.flatMap(country => country.children));
            } else {
                var countryData = jsonData.find(country => country.text === selectedCountry);
                if (countryData) {
                    generateSuggestions(countryData.children);
                }
            }
        });

        generateSuggestions(jsonData.flatMap(country => country.children));
    });
</script>

</body>
</html>
